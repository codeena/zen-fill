<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zen Fill Pro</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0000000000000000" crossorigin="anonymous"></script>
    <script>
      window.adsbygoogle = window.adsbygoogle || [];
      var adBreak = adConfig = function(o) { adsbygoogle.push(o); }
      adConfig({ preloadAdBreaks: 'on' });
    </script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 100vh; font-family: 'Segoe UI', sans-serif; color: white; touch-action: none; }
        #ui-overlay { position: absolute; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); width: 100%; height: 100%; z-index: 50; }
        .ui-content { text-align: center; width: 90%; max-width: 400px; }
        h1 { font-size: 50px; color: #00ffff; text-shadow: 0 0 20px #00ffff; margin-bottom: 20px; }
        input { padding: 15px; font-size: 18px; border-radius: 5px; border: 2px solid #00ffff; background: #111; color: white; text-align: center; margin-bottom: 20px; width: 80%; }
        button { padding: 18px; font-size: 20px; background: #00ffff; border: none; cursor: pointer; border-radius: 50px; font-weight: bold; width: 85%; transition: 0.3s; color: black; }
        button:hover { background: #fff; transform: scale(1.05); }
        #score-box { position: absolute; top: 20px; left: 20px; color: #00ffff; font-size: 24px; font-weight: bold; font-family: monospace; }
        #ad-loading { display: none; position: absolute; z-index: 100; background: #000; width: 100%; height: 100%; align-items: center; justify-content: center; flex-direction: column; }
        .loader { border: 5px solid #333; border-top: 5px solid #00ffff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        canvas { display: block; max-width: 100vw; max-height: 100vh; }
    </style>
</head>
<body>

    <div id="score-box">0</div>
    <div id="ad-loading"><div class="loader"></div><p>LOADING INTERACTIVE AD...</p></div>

    <div id="ui-overlay">
        <div id="entry-screen" class="ui-content">
            <h1>ZEN FILL</h1>
            <input type="text" id="player-name" placeholder="ENTER NAME">
            <button onclick="requestAd('reward')">WATCH AD TO PLAY</button>
        </div>
        <div id="end-screen" class="ui-content" style="display:none;">
            <h1 id="nice-msg">NICE</h1>
            <button onclick="location.reload()">PLAY AGAIN</button>
        </div>
        <div id="pause-screen" class="ui-content" style="display:none;">
            <h1>PAUSED</h1>
            <button onclick="resumeGame()">RESUME</button>
        </div>
    </div>

    <canvas id="canvas"></canvas>

<script>
    // --- AUDIO ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSfx(f, t='sine', d=0.05, s=false) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime);
        if(s) o.frequency.exponentialRampToValueAtTime(f*10, audioCtx.currentTime+d);
        g.gain.setValueAtTime(0.04, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+d);
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime+d);
    }

    // --- AD LOGIC ---
    function requestAd(type) {
        document.getElementById('ad-loading').style.display = 'flex';
        adBreak({
            type: type,
            name: type === 'reward' ? 'start_game' : 'next_level',
            beforeReward: (show) => { show(); },
            adViewed: () => { startGame(); },
            adDismissed: () => { startGame(); },
            adBreakDone: (info) => { 
                document.getElementById('ad-loading').style.display = 'none';
                if (info.breakStatus === 'notReady') startGame(); 
            }
        });
    }

    // --- GAME ENGINE ---
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 600; canvas.height = 600;
    
    let balls = [], rotation = 0, isRunning = false, pName = "";
    const speed = 5.75, ballRad = 6, ringRad = 280, target = 1250;

    function startGame() {
        pName = document.getElementById('player-name').value || "GUEST";
        document.getElementById('ui-overlay').style.display = 'none';
        if (balls.length === 0) {
            balls.push({x:300, y:250, vx:speed, vy:0, color:'#00ffff', inside:true});
        }
        isRunning = true;
        try { navigator.wakeLock.request('screen'); } catch(e){}
        animate();
    }

    function pauseGame() { 
        isRunning = false; 
        document.getElementById('ui-overlay').style.display = 'flex';
        document.getElementById('pause-screen').style.display = 'block';
    }

    function resumeGame() {
        document.getElementById('ui-overlay').style.display = 'none';
        document.getElementById('pause-screen').style.display = 'none';
        isRunning = true; animate();
    }

    document.addEventListener("visibilitychange", () => { if(document.hidden && isRunning) pauseGame(); });

    function animate() {
        if(!isRunning) return;
        ctx.fillStyle = 'black'; ctx.fillRect(0,0,600,600);
        rotation += 0.015;
        
        let count = 0;
        for(let i=balls.length-1; i>=0; i--) {
            let b = balls[i];
            b.x += b.vx; b.y += b.vy;
            let d = Math.sqrt((b.x-300)**2 + (b.y-300)**2);
            
            if (b.inside && d + ballRad > ringRad) {
                let ang = Math.atan2(b.y-300, b.x-300);
                let rel = (ang - rotation) % (Math.PI*2);
                if(rel < 0) rel += Math.PI*2;
                if(rel > 0.25) {
                    let nx = (b.x-300)/d, ny = (b.y-300)/d;
                    let dot = b.vx*nx + b.vy*ny;
                    b.vx -= 2*dot*nx; b.vy -= 2*dot*ny;
                    if(Math.random() < 0.1) playSfx(600, 'sine', 0.02);
                } else {
                    b.inside = false;
                    playSfx(100, 'square', 0.3, true);
                    spawn();
                }
            }
            // Keep speed constant
            let s = Math.sqrt(b.vx**2 + b.vy**2);
            b.vx = (b.vx/s)*speed; b.vy = (b.vy/s)*speed;

            if(b.inside) count++;
            ctx.fillStyle = b.inside ? b.color : 'rgba(255,255,255,0.1)';
            ctx.beginPath(); ctx.arc(b.x, b.y, ballRad, 0, Math.PI*2); ctx.fill();
            if (b.y > 1000 || b.y < -400) balls.splice(i,1);
        }

        ctx.beginPath(); ctx.arc(300, 300, ringRad, rotation + 0.25, rotation + Math.PI*2);
        ctx.strokeStyle = 'white'; ctx.lineWidth = 5; ctx.stroke();
        document.getElementById('score-box').innerText = count;

        if (count >= target) { isRunning = false; finish(); }
        else { requestAnimationFrame(animate); }
    }

    function spawn() {
        if(balls.length > 2500) return;
        const colors = ['#00ffff', '#ff00ff', '#00ffaa', '#ffff00', '#ffffff'];
        const c = colors[Math.floor(Math.random()*colors.length)];
        for(let i=0; i<2; i++) {
            let a = Math.random()*Math.PI*2;
            balls.push({x:300, y:300, vx:Math.cos(a)*speed, vy:Math.sin(a)*speed, color:c, inside:true});
        }
    }

    function finish() {
        document.getElementById('nice-msg').innerText = "NICE " + pName.toUpperCase();
        document.getElementById('ui-overlay').style.display = 'flex';
        document.getElementById('end-screen').style.display = 'block';
        // Request Break Ad at the end
        adBreak({ type: 'next', name: 'restart' });
    }
</script>
</body>
</html>